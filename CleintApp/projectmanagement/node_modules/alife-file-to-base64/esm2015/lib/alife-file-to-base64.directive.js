/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Directive, EventEmitter, ElementRef, Input, Output } from '@angular/core';
export class AlifeFileToBase64Directive {
    /**
     * @param {?} elementRef
     */
    constructor(elementRef) {
        this.elementRef = elementRef;
        this.onFileChanged = new EventEmitter();
        this.fileModelChange = new EventEmitter();
        this.rawFileModelChange = new EventEmitter();
        this.isTypeFile = false;
        this.userCapture = false;
        this.globalFilesData = [];
        this.globalRawFilesData = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.isTypeFile = this.type === 'file';
        this.init();
    }
    /**
     * Initialize the action
     * @return {?}
     */
    init() {
        if (!this.isTypeFile) {
            console.error("alife-file-to-base64 will work only when input type is file.");
            this.removeFileChangeAction();
            return;
        }
        // // Check for the various File API support.
        // if (window.File && window.FileReader && window.FileList && window.Blob) {
        //   // Great success! All the File APIs are supported.
        // } else {
        //   alert('The File APIs are not fully supported in this browser.');
        // }
        this.bindFileChangeAction();
    }
    /**
     * Fire the events
     * @return {?}
     */
    onFileReadingCompleted() {
        this.fileModelChange.next(this.globalFilesData);
        this.rawFileModelChange.next(this.globalRawFilesData);
        this.onFileChanged.next(this.globalFilesData);
    }
    /**
     *
     * Read the files and prepare the output json with base64.
     *
     * @param {?} event
     * @return {?}
     */
    handleFileSelection(event) {
        if (!this.isTypeFile) {
            return;
        }
        /** @type {?} */
        let files = event.target.files;
        this.globalRawFilesData = files;
        /** @type {?} */
        let fileOutput = [];
        for (let i = 0; i < files.length; i++) {
            /** @type {?} */
            let file = files[i];
            /** @type {?} */
            let opt = {
                name: file.name,
                size: file.size,
                type: file.type
            };
            fileOutput.push(opt);
        }
        /** @type {?} */
        var that = this;
        /**
         * @return {?}
         */
        function fileReadingCompleted() {
            that.globalFilesData = fileOutput;
            that.onFileReadingCompleted();
        }
        /** @type {?} */
        var reader = new FileReader();
        /**
         * @param {?} index
         * @return {?}
         */
        function readFile(index) {
            reader.onload = (function (fileData) {
                /** @type {?} */
                let base64 = fileData.target.result;
                fileOutput[index].base64 = base64;
                readFile(index + 1);
            });
            if (index >= files.length) {
                fileReadingCompleted();
                return;
            }
            reader.readAsDataURL(files[index]);
        }
        readFile(0);
    }
    /**
     * Add Event listener action on input
     * @return {?}
     */
    bindFileChangeAction() {
        this.elementRef.nativeElement.addEventListener('change', this.handleFileSelection.bind(this), this.userCapture);
    }
    /**
     * Remove Event listener action on input
     * @return {?}
     */
    removeFileChangeAction() {
        this.elementRef.nativeElement.addEventListener('change', this.handleFileSelection.bind(this), this.userCapture);
    }
}
AlifeFileToBase64Directive.decorators = [
    { type: Directive, args: [{
                selector: '[alife-file-to-base64]'
            },] }
];
/** @nocollapse */
AlifeFileToBase64Directive.ctorParameters = () => [
    { type: ElementRef }
];
AlifeFileToBase64Directive.propDecorators = {
    type: [{ type: Input }],
    fileModel: [{ type: Input }],
    rawFileModel: [{ type: Input }],
    onFileChanged: [{ type: Output }],
    fileModelChange: [{ type: Output }],
    rawFileModelChange: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.type;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.fileModel;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.rawFileModel;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.onFileChanged;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.fileModelChange;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.rawFileModelChange;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.isTypeFile;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.userCapture;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.globalFilesData;
    /** @type {?} */
    AlifeFileToBase64Directive.prototype.globalRawFilesData;
    /**
     * @type {?}
     * @private
     */
    AlifeFileToBase64Directive.prototype.elementRef;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxpZmUtZmlsZS10by1iYXNlNjQuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vYWxpZmUtZmlsZS10by1iYXNlNjQvIiwic291cmNlcyI6WyJsaWIvYWxpZmUtZmlsZS10by1iYXNlNjQuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUtuRixNQUFNLE9BQU8sMEJBQTBCOzs7O0lBZ0JyQyxZQUFvQixVQUFzQjtRQUF0QixlQUFVLEdBQVYsVUFBVSxDQUFZO1FBVmhDLGtCQUFhLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDM0Qsb0JBQWUsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUN4RCx1QkFBa0IsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUVyRSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBQzVCLGdCQUFXLEdBQVksS0FBSyxDQUFDO1FBRTdCLG9CQUFlLEdBQVEsRUFBRSxDQUFDO1FBQzFCLHVCQUFrQixHQUFRLEVBQUUsQ0FBQztJQUVpQixDQUFDOzs7O0lBRS9DLFFBQVE7UUFDTixJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLEtBQUssTUFBTSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNkLENBQUM7Ozs7O0lBS0QsSUFBSTtRQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsOERBQThELENBQUMsQ0FBQztZQUM5RSxJQUFJLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUM5QixPQUFPO1NBQ1I7UUFDRCw2Q0FBNkM7UUFDN0MsNEVBQTRFO1FBQzVFLHVEQUF1RDtRQUN2RCxXQUFXO1FBQ1gscUVBQXFFO1FBQ3JFLElBQUk7UUFDSixJQUFJLENBQUMs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RTs7SUFFckUsZ0RBQTRCOztJQUM1QixpREFBNkI7O0lBRTdCLHFEQUEwQjs7SUFDMUIsd0RBQTZCOzs7OztJQUVqQixnREFBOEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBEaXJlY3RpdmUsIEV2ZW50RW1pdHRlciwgRWxlbWVudFJlZiwgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5cclxuQERpcmVjdGl2ZSh7XHJcbiAgc2VsZWN0b3I6ICdbYWxpZmUtZmlsZS10by1iYXNlNjRdJ1xyXG59KVxyXG5leHBvcnQgY2xhc3MgQWxpZmVGaWxlVG9CYXNlNjREaXJlY3RpdmUge1xyXG5cclxuICBASW5wdXQoKSB0eXBlOiBzdHJpbmc7XHJcbiAgQElucHV0KCkgZmlsZU1vZGVsOiBhbnk7XHJcbiAgQElucHV0KCkgcmF3RmlsZU1vZGVsOiBhbnk7XHJcblxyXG4gIEBPdXRwdXQoKSBvbkZpbGVDaGFuZ2VkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xyXG4gIEBPdXRwdXQoKSBmaWxlTW9kZWxDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG4gIEBPdXRwdXQoKSByYXdGaWxlTW9kZWxDaGFuZ2U6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xyXG5cclxuICBpc1R5cGVGaWxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgdXNlckNhcHR1cmU6IGJvb2xlYW4gPSBmYWxzZTtcclxuXHJcbiAgZ2xvYmFsRmlsZXNEYXRhOiBhbnkgPSBbXTtcclxuICBnbG9iYWxSYXdGaWxlc0RhdGE6IGFueSA9IFtdO1xyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHsgfVxyXG5cclxuICBuZ09uSW5pdCgpIHtcclxuICAgIHRoaXMuaXNUeXBlRmlsZSA9IHRoaXMudHlwZSA9PT0gJ2ZpbGUnO1xyXG4gICAgdGhpcy5pbml0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIHRoZSBhY3Rpb25cclxuICAgKi9cclxuICBpbml0KCkge1xyXG4gICAgaWYgKCF0aGlzLmlzVHlwZUZpbGUpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcImFsaWZlLWZpbGUtdG8tYmFzZTY0IHdpbGwgd29yayBvbmx5IHdoZW4gaW5wdXQgdHlwZSBpcyBmaWxlLlwiKTtcclxuICAgICAgdGhpcy5yZW1vdmVGaWxlQ2hhbmdlQWN0aW9uKCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIC8vIC8vIENoZWNrIGZvciB0aGUgdmFyaW91cyBGaWxlIEFQSSBzdXBwb3J0LlxyXG4gICAgLy8gaWYgKHdpbmRvdy5GaWxlICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5GaWxlTGlzdCAmJiB3aW5kb3cuQmxvYikge1xyXG4gICAgLy8gICAvLyBHcmVhdCBzdWNjZXNzISBBbGwgdGhlIEZpbGUgQVBJcyBhcmUgc3VwcG9ydGVkLlxyXG4gICAgLy8gfSBlbHNlIHtcclxuICAgIC8vICAgYWxlcnQoJ1RoZSBGaWxlIEFQSXMgYXJlIG5vdCBmdWxseSBzdXBwb3J0ZWQgaW4gdGhpcyBicm93c2VyLicpO1xyXG4gICAgLy8gfVxyXG4gICAgdGhpcy5iaW5kRmlsZUNoYW5nZUFjdGlvbigpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmlyZSB0aGUgZXZlbnRzXHJcbiAgICovXHJcbiAgb25GaWxlUmVhZGluZ0NvbXBsZXRlZCgpIHtcclxuICAgIHRoaXMuZmlsZU1vZGVsQ2hhbmdlLm5leHQodGhpcy5nbG9iYWxGaWxlc0RhdGEpO1xyXG4gICAgdGhpcy5yYXdGaWxlTW9kZWxDaGFuZ2UubmV4dCh0aGlzLmdsb2JhbFJhd0ZpbGVzRGF0YSk7XHJcbiAgICB0aGlzLm9uRmlsZUNoYW5nZWQubmV4dCh0aGlzLmdsb2JhbEZpbGVzRGF0YSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBcclxuICAgKiBSZWFkIHRoZSBmaWxlcyBhbmQgcHJlcGFyZSB0aGUgb3V0cHV0IGpzb24gd2l0aCBiYXNlNjQuXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGV2ZW50XHJcbiAgICovXHJcbiAgaGFuZGxlRmlsZVNlbGVjdGlvbihldmVudCkge1xyXG5cclxuICAgIGlmICghdGhpcy5pc1R5cGVGaWxlKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZmlsZXMgPSBldmVudC50YXJnZXQuZmlsZXM7XHJcbiAgICB0aGlzLmdsb2JhbFJhd0ZpbGVzRGF0YSA9IGZpbGVzO1xyXG5cclxuICAgIGxldCBmaWxlT3V0cHV0ID0gW107XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBsZXQgZmlsZSA9IGZpbGVzW2ldO1xyXG4gICAgICBsZXQgb3B0ID0ge1xyXG4gICAgICAgIG5hbWU6IGZpbGUubmFtZSxcclxuICAgICAgICBzaXplOiBmaWxlLnNpemUsXHJcbiAgICAgICAgdHlwZTogZmlsZS50eXBlXHJcbiAgICAgIH1cclxuICAgICAgZmlsZU91dHB1dC5wdXNoKG9wdCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHZhciB0aGF0ID0gdGhpcztcclxuICAgIGZ1bmN0aW9uIGZpbGVSZWFkaW5nQ29tcGxldGVkKCkge1xyXG4gICAgICB0aGF0Lmdsb2JhbEZpbGVzRGF0YSA9IGZpbGVPdXRwdXQ7XHJcbiAgICAgIHRoYXQub25GaWxlUmVhZGluZ0NvbXBsZXRlZCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xyXG4gICAgZnVuY3Rpb24gcmVhZEZpbGUoaW5kZXgpIHtcclxuXHJcbiAgICAgIHJlYWRlci5vbmxvYWQgPSAoZnVuY3Rpb24gKGZpbGVEYXRhOiBhbnkpIHtcclxuICAgICAgICBsZXQgYmFzZTY0ID0gZmlsZURhdGEudGFyZ2V0LnJlc3VsdDtcclxuICAgICAgICBmaWxlT3V0cHV0W2luZGV4XS5iYXNlNjQgPSBiYXNlNjQ7XHJcbiAgICAgICAgcmVhZEZpbGUoaW5kZXggKyAxKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAoaW5kZXggPj0gZmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgZmlsZVJlYWRpbmdDb21wbGV0ZWQoKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZXNbaW5kZXhdKTtcclxuICAgIH1cclxuXHJcbiAgICByZWFkRmlsZSgwKTtcclxuXHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBZGQgRXZlbnQgbGlzdGVuZXIgYWN0aW9uIG9uIGlucHV0IFxyXG4gICAqL1xyXG4gIGJpbmRGaWxlQ2hhbmdlQWN0aW9uKCkge1xyXG4gICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5oYW5kbGVGaWxlU2VsZWN0aW9uLmJpbmQodGhpcyksIHRoaXMudXNlckNhcHR1cmUpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVtb3ZlIEV2ZW50IGxpc3RlbmVyIGFjdGlvbiBvbiBpbnB1dCBcclxuICAgKi9cclxuICByZW1vdmVGaWxlQ2hhbmdlQWN0aW9uKCkge1xyXG4gICAgdGhpcy5lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgdGhpcy5oYW5kbGVGaWxlU2VsZWN0aW9uLmJpbmQodGhpcyksIHRoaXMudXNlckNhcHR1cmUpO1xyXG4gIH1cclxuXHJcbn1cclxuIl19