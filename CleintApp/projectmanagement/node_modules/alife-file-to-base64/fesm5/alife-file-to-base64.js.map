{"version":3,"file":"alife-file-to-base64.js.map","sources":["ng://alife-file-to-base64/lib/alife-file-to-base64.directive.ts","ng://alife-file-to-base64/lib/alife-file-to-base64.module.ts"],"sourcesContent":["import { Directive, EventEmitter, ElementRef, Input, Output } from '@angular/core';\r\n\r\n@Directive({\r\n  selector: '[alife-file-to-base64]'\r\n})\r\nexport class AlifeFileToBase64Directive {\r\n\r\n  @Input() type: string;\r\n  @Input() fileModel: any;\r\n  @Input() rawFileModel: any;\r\n\r\n  @Output() onFileChanged: EventEmitter<any> = new EventEmitter<any>();\r\n  @Output() fileModelChange: EventEmitter<any> = new EventEmitter();\r\n  @Output() rawFileModelChange: EventEmitter<any> = new EventEmitter();\r\n\r\n  isTypeFile: boolean = false;\r\n  userCapture: boolean = false;\r\n\r\n  globalFilesData: any = [];\r\n  globalRawFilesData: any = [];\r\n\r\n  constructor(private elementRef: ElementRef) { }\r\n\r\n  ngOnInit() {\r\n    this.isTypeFile = this.type === 'file';\r\n    this.init();\r\n  }\r\n\r\n  /**\r\n   * Initialize the action\r\n   */\r\n  init() {\r\n    if (!this.isTypeFile) {\r\n      console.error(\"alife-file-to-base64 will work only when input type is file.\");\r\n      this.removeFileChangeAction();\r\n      return;\r\n    }\r\n    // // Check for the various File API support.\r\n    // if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n    //   // Great success! All the File APIs are supported.\r\n    // } else {\r\n    //   alert('The File APIs are not fully supported in this browser.');\r\n    // }\r\n    this.bindFileChangeAction();\r\n  }\r\n\r\n  /**\r\n   * Fire the events\r\n   */\r\n  onFileReadingCompleted() {\r\n    this.fileModelChange.next(this.globalFilesData);\r\n    this.rawFileModelChange.next(this.globalRawFilesData);\r\n    this.onFileChanged.next(this.globalFilesData);\r\n  }\r\n\r\n  /**\r\n   * \r\n   * Read the files and prepare the output json with base64.\r\n   * \r\n   * @param event\r\n   */\r\n  handleFileSelection(event) {\r\n\r\n    if (!this.isTypeFile) {\r\n      return;\r\n    }\r\n\r\n    let files = event.target.files;\r\n    this.globalRawFilesData = files;\r\n\r\n    let fileOutput = [];\r\n\r\n    for (let i = 0; i < files.length; i++) {\r\n      let file = files[i];\r\n      let opt = {\r\n        name: file.name,\r\n        size: file.size,\r\n        type: file.type\r\n      }\r\n      fileOutput.push(opt);\r\n    }\r\n\r\n\r\n    var that = this;\r\n    function fileReadingCompleted() {\r\n      that.globalFilesData = fileOutput;\r\n      that.onFileReadingCompleted();\r\n    }\r\n\r\n    var reader = new FileReader();\r\n    function readFile(index) {\r\n\r\n      reader.onload = (function (fileData: any) {\r\n        let base64 = fileData.target.result;\r\n        fileOutput[index].base64 = base64;\r\n        readFile(index + 1);\r\n      });\r\n\r\n      if (index >= files.length) {\r\n        fileReadingCompleted();\r\n        return;\r\n      }\r\n      reader.readAsDataURL(files[index]);\r\n    }\r\n\r\n    readFile(0);\r\n\r\n  }\r\n\r\n  /**\r\n   * Add Event listener action on input \r\n   */\r\n  bindFileChangeAction() {\r\n    this.elementRef.nativeElement.addEventListener('change', this.handleFileSelection.bind(this), this.userCapture);\r\n  }\r\n\r\n  /**\r\n   * Remove Event listener action on input \r\n   */\r\n  removeFileChangeAction() {\r\n    this.elementRef.nativeElement.addEventListener('change', this.handleFileSelection.bind(this), this.userCapture);\r\n  }\r\n\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { AlifeFileToBase64Directive } from './alife-file-to-base64.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n  ],\r\n  declarations: [AlifeFileToBase64Directive],\r\n  exports: [AlifeFileToBase64Directive]\r\n})\r\nexport class AlifeFileToBase64Module { }\r\n"],"names":[],"mappings":"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"}
